#ifndef iLiveLoginMgr_h_
#define iLiveLoginMgr_h_

#include <imsdk/tim_comm.h>
#include <avsdk/av_callback.h>
#include <ilivesdk/iLiveCommon.h>

namespace ilivesdk
{
	typedef void (*ForceOfflineCallback)(); ///< 被挤下线回调函数指针类型;

	/**
	@brief 登录、登出的封装;
	*/
	class iLiveAPI iLiveLoginMgr
	{
		friend class iLiveSDK;
		class IMLoginCallBack : public TIMCallBack
		{
		public:
			virtual void	OnSuccess();
			virtual void	OnError(int code, const std::string &desc);
		};

		class IMLogoutCallBack : public TIMCallBack
		{
		public:
			virtual void	OnSuccess();
			virtual void	OnError(int code, const std::string &desc);
		};

		class StartAVContextCallBack : public AVCallback
		{
		public:
			virtual void OnComplete(int32 result, const std::string& error_info) override;
		};

	public:
		/**
		@brief 获取单例对象。
		@return 单例对象
		*/
		static iLiveLoginMgr*	getInstance();

		/**
		@brief 设置被挤下线的回调。
		@param [in] cb 回调接口的指针;
		@remark 账号在其他地方登陆时，会收到此回调;
		*/
		void					setForceOfflineCallback(ForceOfflineCallback cb);
		/**
		@brief 登录
		@param [in] szUserId 用户id
		@param [in] szUserSig 用户Sig
		@param [in] suc 成功的回调函数指针
		@param [in] err 失败的回调函数指针
		@param [in] data 用户自定义的数据的指针，在成功和失败的回调函数中原封不动地返回;
		*/
		void					iLiveLogin( const std::string szUserId, const std::string szUserSig, SuccessCalllback suc, ErrorCallback err, void* data );
		/**
		@brief 登出
		@param [in] suc 成功回调函数指针
		@param [in] err 失败回调函数指针
		@param [in] data 用户自定义的数据的指针，在成功和失败的回调函数中原封不动地返回;
		*/
		void					iLiveLogout( SuccessCalllback suc, ErrorCallback err, void* data );
		/**
		@brief 获取已经登录用户ID(只有登录成功后才能获取)
		@return 返回已经登录用户的ID
		*/
		std::string				getLoginId();
		/**
		@brief 获取已经登录用户Sig(只有登录成功后才能获取)
		@return 返回已经登录用户的Sig
		*/
		std::string				getUserSig();

	private:
		iLiveLoginMgr();
		void					OnIMLoginSuc();
		void					OnIMLoginErr(int code, const std::string& desc);
		void					OnIMLogoutSuc();
		void					OnIMLogoutErr(int code, const std::string& desc);
		void					OnStartContextCompleteCallback(int result, const std::string& error_info);
		
	private:
		IMLoginCallBack				m_timLoginCallback;
		IMLogoutCallBack			m_timLogoutCallBack;
		StartAVContextCallBack		m_startAVContextCallBack;

		ForceOfflineCallback		m_pForceOfflineCB;

		SuccessCalllback			m_pLoginSuccessCB;
		ErrorCallback				m_pLoginErrorCB;
		void*						m_pLoginData;

		SuccessCalllback			m_pLogoutSuccessCB;
		ErrorCallback				m_pLogoutErrorCB;
		void*						m_pLogoutData;

		std::string					m_szUserId;
		std::string					m_szUserSig;
	};
}


#endif //iLiveLoginMgr_h_